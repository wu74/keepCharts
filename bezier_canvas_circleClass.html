<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <style>
    #container {
      position: relative;
      width: 400px;
      height: 400px;
      margin: 20px auto;
    }
  </style>
</head>

<body>
  <div id="container">
    <canvas id="graph" width="400" height="400"></canvas>
  </div>

  <button id="btn1">移动point1</button>
  <button id="btn2">移动point2</button>

  <script src="./js/circle.js"></script>
  <script>
    const container = document.querySelector('#container')
    const c = container.querySelector('#graph')
    const ctx = c.getContext('2d', { willReadFrequently: true })

    const btn1 = document.querySelector('#btn1')
    const btn2 = document.querySelector('#btn2')

    let pos1 = { x: 50, y: 50, r: 10 }
    let pos2 = { x: 250, y: 250, r: 10 }


    let p1 = new Circle(pos1, ctx, c)
    let p2 = new Circle(pos2, ctx, c)

    render()

    p1.draw()
    p2.draw()



    p1.onClick = function (e) {
      ctx.clearRect(0, 0, 400, 400)

      render()

      this.setAttr({
        type: 'color',
        color: 'red'
      })

      p1.draw()
      p2.draw()
    }

    p2.onClick = function (e) {
      ctx.clearRect(0, 0, 400, 400)

      render()

      this.setAttr({
        type: 'color',
        color: 'green'
      })

      p1.draw()
      p2.draw()
    }

    p1.onDrag = p2.onDrag = function (e) {

      let x = e.pageX - this.canvasLeft
      let y = e.pageY - this.canvasTop

      ctx.clearRect(0, 0, 400, 400)

      render()

      this.setAttr({
        type: 'position',
        x,
        y
      })

      p1.draw()
      p2.draw()
    }

    btn1.addEventListener('click', function() {
      p1.setAttr({
        type: 'position',
        x: 100,
        y: 100
      })
      render()
      p1.draw()
      p2.draw()
    })

    btn2.addEventListener('click', function() {
      p2.setAttr({
        type: 'position',
        x: 300,
        y: 300
      })

      render()
      p1.draw()
      p2.draw()
    })


    function drawBezier() {
      ctx.beginPath()
      ctx.lineWidth = 4
      ctx.strokeStyle = '#000000'
      ctx.moveTo(0, 400)
      ctx.bezierCurveTo(p1.x, p1.y, p2.x, p2.y, 400, 0)
      ctx.stroke()
    }

    function drawControlLine() {
      ctx.lineWidth = 2
      ctx.strokeStyle = '#696969'

      ctx.beginPath()
      ctx.moveTo(0, 400)
      ctx.lineTo(p1.x, p1.y)
      ctx.stroke()
      ctx.closePath()

      ctx.beginPath()
      ctx.moveTo(400, 0)
      ctx.lineTo(p2.x, p2.y)
      ctx.stroke()
      ctx.closePath()
    }

    function drawBg() {
      // 先画背景
      let count = 0
      let width = c.clientWidth
      let height = 20
      let sy = 0
      let i = 0

      while (count < c.clientHeight) {
        ctx.beginPath()
        ctx.fillStyle = i % 2 === 0 ? '#f0f0f0' : '#fff'
        ctx.fillRect(0, sy, width, height)
        ctx.closePath()
        sy += 20
        count += 20
        i++
      }

      // 再画坐标轴和斜线
      ctx.strokeStyle = '#8d8d8d'
      ctx.lineWidth = 2

      ctx.beginPath()
      ctx.moveTo(0, 0)
      ctx.lineTo(0, 400)
      ctx.stroke()
      ctx.closePath()

      ctx.beginPath()
      ctx.moveTo(0, 400)
      ctx.lineTo(400, 400)
      ctx.stroke()
      ctx.closePath()

      ctx.beginPath()
      ctx.lineWidth = 5
      ctx.strokeStyle = '#e5e5e5'
      ctx.moveTo(0, 400)
      ctx.lineTo(400, 0)
      ctx.stroke()
      ctx.closePath()
    }

    function render() {
      drawBg()

      drawControlLine()

      drawBezier()
    }
  </script>
</body>

</html>