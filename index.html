<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>k</title>
  <style>
    #hoverTip {
      display: none;
      position: absolute;
      top: 50px;
      width: 190px;
      height: 270px;
      background-color: rgba(243, 245, 250, .5);
    }
  </style>
</head>

<body>
  <canvas
    id="graph"
    width="930"
    height="455"
    style="position: relative;"
  ></canvas>

  <div id="hoverTip"></div>

  <script src="./index.js"></script>
  <script>
    const hoverDom = document.querySelector('#hoverTip')

    let pen = new Pen('#graph')

    // 坐标系
    pen.drawLine(25, 0, 25, 430)
      .drawLine(25, 430, 900, 430)

    // 蜡烛图
    pen.drawCandle(50, 50, 25, 40, 'fill', 'rgb(10,171,98)')
      .drawCandle(100, 100, 30, 60, 'fill', 'rgb(255,51,51)')
      .drawCandle(500, 50, 25, 50, 'fill', 'rgb(10,171,98)')

    const yData = ['146.3', '120.8', '95.4', '70', '50']
    const xData = ['20220919',
      '20220928',
      '20221010',
      '20221019',
      '20221028']

    pen.ctx.fillStyle = '#525252'
    yData.forEach((text, i) => {
      pen.ctx.textAlign = 'right'
      pen.ctx.fillText(text, 20, i * 100,)
    })

    xData.forEach((text, i) => {
      pen.ctx.textBaseline = 'top'
      pen.ctx.fillText(text, i * 200, 435)
    })

    pen.graph.addEventListener('mouseenter', function() {
      pen.graph.addEventListener('mousemove', mousemoveFn)
    })
    pen.graph.addEventListener('mouseleave', function () {
      hoverDom.style.display = 'none'
      pen.graph.removeEventListener('mousemove', mousemoveFn)
    })


    let isCreated = false

    function mousemoveFn(e) {
      let x = e.offsetX
      let y = e.offsetY

      // 第一次进入时绘制 虚线坐标轴
      if (isCreated) {
        // hoverDom 的 操作
        // 计算该悬浮的位置
        if (hoverDom.style.display = 'none') {
          hoverDom.style.display = 'block'
        }

        let x = e.pageX

        if (x > pen.graph.clientWidth * 0.5) {
          x = x - hoverDom.clientWidth
        }

        x = x + 10

        hoverDom.style.left = x + 'px'
        // 移动
      } else {
        isCreated = true
        // 新建
        pen.drawLine(25, y, 900, y, '#bfbfbf', [3])
           .drawLine(x, 0, x, 430, '#bfbfbf', [3])
      }
    }
  </script>
</body>

</html>